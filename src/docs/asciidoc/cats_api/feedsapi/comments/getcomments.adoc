==== Метод: Получение комментариев поста

*1. Название метода:*

- *Название метода:* Получить комментарии по идентификатору поста

- *URL и Endpoint:* GET https://cats-feeds.ru/feeds/posts/{postId}/comment

*2. Общее описание метода:*

- *Что это:* Метод получения комментариев к посту пользователя.

- *Для чего мы это делаем:* Пользователи смогут увидеть все комментарии которые были оставлены к посту.

*Роли пользователей:* Аутентифицированные пользователи.

*3. Алгоритм работы:*

- *Кто делает запрос:* Аутентифицированные пользователи.

- *Кто обрабатывает:* 

- Сервис аутентификации (CatsAuth Service) валидирует JWT токен.

- Сервис работы с лентой (CatsFeeds Service) обрабатывает загрузку, извлекает данные.

- *К каким таблицам БД обращение:*

 - Таблица post_comments CatsFeeds Service извлекает данные.
 - Таблица tokens для создания новой записи с refresh_token.

*Шаги:*

1) *Пользователь:* 	Пользователь отправляет запрос на получение комментариев поста с JWT-токеном.

2) *API Gateway:* Перенаправляет запрос в CatsFeeds Service.

3) *CatsFeeds:* Проверяет валидность JWT через CatsAuth.

4) *Catsauth Service:*

- Проверяет JWT токен.

- Если токен истек, сервер проверяет refresh_token и выдает новый JWT.

5) *CatsFeeds:*  Извлекает комментарии из базы данных.

6) *CatsFeeds:* Возвращает список комментариев пользователю.

*4. Пример запроса:*

- *Метод:* GET

- *URL:* https://cats-feeds.ru/feeds/posts/{postId}/comment

- *query-параметры:* limit=50&pages=1

- *Headers:* 
- Content-Type: application/json
- Authorization: Bearer <jwt-token>

*4.2. Тело запроса:* Отсутствует

*5. Пример ответа:*

- *HTTP-200:* Комментарии получены.

*Тело ответа:*
[source,json]
----
[
  {
    "commentId": "1",
    "postId": "1",
    "userId": "2343",
    "comment": "Cute cat!",
    "commentedAt": "2024-06-24T12:34:56Z"
  },
  {
    "commentId": "2",
    "postId": "2",
    "userId": "2344",
    "comment": "Funny!",
    "commentedAt": "2024-06-24T12:34:56Z"
  },
]
----

- *HTTP-401:* Невалидный или просроченный токен.
*Тело ответа:*
[source,json]
----
{
  "error": "Unauthorized",
  "message": "Token is invalid or expired."
}
----


*Таблицы маппинга данных JSON и БД*

*6.1 Выходные параметры GET https://cats-feeds.ru/feeds/posts/{postId}/comment*

|===
|*Название параметра на русском*|*Название параметра в JSON*|*Тип данных в JSON*|*Название параметра в БД*|*Тип данных в БД*|*Описание и алгоритм обработки данных*

|Идентификатор комментария
|commentId
|number
|post_comments.comments_id
|UUID
|Уникальный идентификатор комментария, создается сервером и возвращается в ответе

|Идентификатор поста
|postId
|number
|post_comments.post_id
|UUID
|Уникальный идентификатор поста, создается сервером и возвращается в ответе

|Идентификатор пользователя
|userId
|number
|post_comments.user_id
|UUID
|Возвращается после успешной аутентификации

|Комментарий
|comment
|string
|post_comments.comment
|text
|Комментарий пользователя к посту

|Время публикации комментария
|commentedAt
|string
|post_comments.commented_at
|TIMESTAMP
|Время публикации комментария, генерируется сервером и возвращается в ответе
|===

xref:../../../index.adoc[Назад]