==== Метод: Удаление поста

*1. Название метода:*

- *Название метода:*  Удалить пост

- *URL и Endpoint:* DELETE https://cats-feeds.ru/posts/{postId}

*2. Общее описание метода:*

- *Что это:* Метод позволяет пользователю удалить существующий пост.

- *Для чего мы это делаем:* Пользователи могут удалять свои посты.

*Роли пользователей:* Аутентифицированные пользователи.

*3. Алгоритм работы:*

- *Кто делает запрос:* Пользователь отправляет запрос на удаление поста.

- *Кто обрабатывает:* 

- Сервис аутентификации (CatsAuth Service) валидирует JWT токен 

- Сервис работы с лентой (CatsFeeds Service) удаляет пост

- *К каким таблицам БД обращение:*

 - Таблица posts CatsFeeds Service удаляет пост.

*Шаги:*

1) *Пользователь:* Отправляет отправляет запрос на DELETE /posts/{postId} на редактирование поста.

2) *API Gateway:* Перенаправляет запрос в CatsFeeds.

3) *CatsFeeds:* Проверяет валидность JWT через CatsAuth.

4) *CatsAuth:*

- Проверяет JWT токен.

- Если токен истек, сервер проверяет refresh_token и выдает новый JWT.

5) *CatsFeeds* Проверяет, что пользователь является автором поста.

6) *CatsFeeds:* Удаляет запись из базы данных.

7) *CatsFeeds:* Удаляет связанные лайки и комментарии из базы данных.

8) *CatsFeeds:* Возвращает подтверждение удаления поста пользователю.

*4. Пример запроса:*

- *Метод:* DELETE

- *URL:* https://cats-feeds.ru/posts/{postId}

- *query-параметры:* нет

- *Headers:* 

- Content-Type: application/json
- Authorization: Bearer {token}

*4.2. Тело запроса:* Отсутствует

*5. Пример ответа:*

- *HTTP-200:* Пост удален.

*Тело ответа:*
[source,json]
----
{
  "postId": "12"
  "message": "Post deleted"
}
----

- *HTTP-401:* Невалидный или просроченный токен.
*Тело ответа:*
[source,json]
----
{
  "error": "Unauthorized",
  "message": "Token is invalid or expired."
}
----

- *HTTP-404:* Пост не найден.
*Тело ответа:*
[source,json]
----
{
  "error": "Unauthorized",
  "message": "Post not found"
}
----


*Таблицы маппинга данных JSON и БД*

*6. Выходные параметры PATCH https://cats-feeds.ru/posts/{postId}*

|===
|*Название параметра на русском*|*Название параметра в JSON*|*Тип данных в JSON*|*Название параметра в БД*|*Тип данных в БД*|*Описание и алгоритм обработки данных*

|Идентификатор поста
|postId
|string
|posts.post_id
|UUID
|Уникальный идентификатор поста, создается сервером и возвращается в ответе
|===

xref:../../../index.adoc[Назад]