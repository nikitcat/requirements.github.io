==== Метод: Регистрация пользователя

*1. Название метода:*

- *Название метода:* Регистрация нового пользователя

- *URL и Endpoint:* POST https://cats-mobile.ru/user/signup

*2. Общее описание метода:*

- *Что это:* Метод для создания новой учётной записи пользователя.

- *Для чего мы это делаем:* Для регистрации новых пользователей в системе, предоставляя им доступ к функционалу мобильного приложения.

*Роли пользователей:* Аутентифицированные пользователи, неавторизованные пользователи (гости).

*3. Алгоритм работы:*

- *Кто делает запрос:* Гость.

- *Кто обрабатывает:* Сервис аутентификации (Catsauth Service).

- *К каким таблицам БД обращение:* Таблица users для создания новой записи пользователя.

*Шаги:*

1) *Гость:* Отправляет запрос с данными регистрации.

2) *API Gateway:* Перенаправляет запрос в Catsauth Service.

3) *Catsauth Service:*

- Проверяет, не существует ли пользователь с таким email.

- Хэширует пароль.

- Создаёт новую запись в таблице users.

4) *Catsauth Service:* Возвращает JWT токен и refresh_token.

5) *API Gateway:* Возвращает результат клиенту.

*4. Пример запроса:*

- *Метод:* POST

- *URL:* https://cats-mobile.ru/api/v1/user/register

- *query-параметры:* нет

- *Headers:* Content-Type: application/json

- *Требования к авторизации:* Нет (гость)

*4.2. Тело запроса:*
[source, json]
----
{
  "userName": "CatLover",
  "email": "catlover@example.com",
  "password": "securepassword123"
}
----
*5. Пример ответа:*

- *HTTP-201:* Успешная регистрация.

*Тело ответа:*
[source,json]
----
{
  "userId": 1,
  "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI...",
  "refreshToken": "dGhpcyByZWZyZXNoIHRva2VuCg=="
}
----

- *HTTP-400:* Некорректные данные.
*Тело ответа:*
[source,json]
----
{
  "error": "Invalid email format."
}
----

- *HTTP-409:* Пользователь уже существует.
*Тело ответа:*
[source,json]
----
{
  "error": "User with this email already exists."
}
----

*Таблицы маппинга данных JSON и БД*

*6. Входные параметры POST https://cats-mobile.ru/user/signup*

|===
|*Название параметра на русском*|*Название параметра в JSON*|*Тип данных в JSON*|*Название параметра в БД*|*Тип данных в БД*|*Описание и алгоритм обработки данных*

|Имя пользователя
|userName
|string
|users.user_name
|VARCHAR(64)
|Проверка на уникальность, сохранение в нижнем регистре

|Электронная почта
|email
|string
|users.email
|VARCHAR(256)
|Проверка на уникальность, сохранение в нижнем регистре

|Пароль
|password
|string
|users.password_hash
|VARCHAR(128)
|Хэширование и сохранение хэша в формате MD5+соль
|===

*6.1 Выходные параметры POST https://cats-mobile.ru/user/signup*

|===
|*Название параметра на русском*|*Название параметра в JSON*|*Тип данных в JSON*|*Название параметра в БД*|*Тип данных в БД*|*Описание и алгоритм обработки данных*

|Идентификатор пользователя
|userId
|number
|users.user_id
|UUID
|Возвращается после создания записи

|JWT токен
|accessToken
|string
|-
|-
|Генерируется и возвращается

|Refresh-токен
|refreshToken
|string
|tokens.refresh_token
|VARCHAR(128)
|Сохраняется в БД и возвращается
|===

*Алгоритм обработки данных*

*Регистрация пользователя:*

1. Проверка, существует ли пользователь с таким email в таблице users.

2. Если email уникален, хэшировать password и создать новую запись в таблице users с полями user_name, email, 
password_hash.

3. Сгенерировать accessToken и refreshToken, сохранить refreshToken в таблице tokens.

4. Вернуть userId, accessToken, refreshToken клиенту.

xref:../../index.adoc[Назад]