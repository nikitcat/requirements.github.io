==== Метод: Авторизация пользователя

*1. Название метода:*

- *Название метода:* Выход из системы

- *URL и Endpoint:* DELETE https://cats-auth.ru/auth/logout

*2. Общее описание метода:*

- *Что это:* Метод для выхода из системы.

- *Для чего мы это делаем:* Для удаления refresh_token из системы и завершения сессии пользователя.

*Роли пользователей:* Аутентифицированные пользователи.

*3. Алгоритм работы:*

- *Кто делает запрос:* Аутентифицированный пользователь.

- *Кто обрабатывает:* Сервис аутентификации (Catsauth Service).

- *К каким таблицам БД обращение:*

 - Таблица tokens для удаления записи refresh_token.

*Шаги:*

1) *Аутентифицированный пользователь:* Отправляет запрос на выход из приложения.

2) *API Gateway:* Перенаправляет запрос в Catsauth Service.

3) *Catsauth Service:* Удаляет запись refresh_token из таблицы tokens.

4) *Catsauth Service:* Возвращает успешное завершение операции.

5) *API Gateway:* Возвращает результат клиенту.

*4. Пример запроса:*

- *Метод:* DELETE

- *URL:* https://cats-auth.ru/auth/logout

- *query-параметры:* нет

- *Headers:* 
- Content-Type: application/json
- Authorization: Bearer <старый_access_token>

- *Требования к авторизации:* Нет (гость)

*4.2. Тело запроса:*
[source, json]
----
{
  "refreshToken": "dGhpcyByZWZyZXNoIHRva2VuCg=="
}
----
*5. Пример ответа:*

- *HTTP-200:* Успешный выход пользователя.

*Тело ответа:*
[source,json]
----
{
  "message": "User successfully logged out."
}
----

- *HTTP-400:* Неправильный или отсутствующий refresh_token.
*Тело ответа:*
[source,json]
----
{
  "error": "Invalid or missing refresh token."
}
----

*Таблицы маппинга данных JSON и БД*

*6. Входные параметры DELETE https://cats-auth.ru/auth/logout*
|===
|*Название параметра на русском*|*Название параметра в JSON*|*Тип данных в JSON*|*Название параметра в БД*|*Тип данных в БД*|*Описание и алгоритм обработки данных*

|Refresh-токен
|refreshToken
|string
|tokens.refresh_token
|VARCHAR(255)
|Поиск и проверка refresh_token
|===

*6.1 Выходные параметры DELETE https://cats-auth.ru/auth/logout*
|===
|*Название параметра на русском*|*Название параметра в JSON*|*Тип данных в JSON*|*Название параметра в БД*|*Тип данных в БД*|*Описание и алгоритм обработки данных*

|Сообщение
|message
|string
|-
|-
|Возвращается после успешного выхода
|===

*Алгоритм обработки данных*

*Выход из системы:*

1. Найти и удалить запись с refreshToken в таблице tokens.

2. Вернуть сообщение о успешном выходе клиенту.

xref:../../index.adoc[Назад]