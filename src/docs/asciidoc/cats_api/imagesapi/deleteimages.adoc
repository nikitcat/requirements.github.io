==== Метод: Удаление фото по идентификатору

*1. Название метода:*

- *Название метода:* Удаление фото

- *URL и Endpoint:* DELETE https://cats-images.ru/images/{imageId}

*2. Общее описание метода:*

- *Что это:* Метод позволяет пользователям удалять свои фото по идентификатору. Он удаляет фото из объектного хранилища MinIO и удаляет запись о фото из базы данных PostgreSQL.

- *Для чего мы это делаем:* Пользователь может удалять свои изображения.

*Роли пользователей:* Аутентифицированные пользователи.

*3. Алгоритм работы:*

- *Кто делает запрос:* Пользователь удаляет изображение.

- *Кто обрабатывает:* 

- Сервис аутентификации (CatsAuth Service) валидирует JWT токен 

- Сервис загрузки фото  (CatsImages Service) Обрабатывает запрос, удаляет изображение из MinIO и его метаданные из базы данных.

- *К каким таблицам БД обращение:*

 - Таблица images CatsImages Service удаляет метаданные фото в таблице.

*Шаги:*

1) *Пользователь:* Отправляет DELETE запрос на /images/{imageId} с авторизационным заголовком.

2) *API Gateway:* Перенаправляет запрос в CatsImages.

3) *CatsImages* Получает запрос и извлекает JWT токен.

4) *CatsAuth:*

- Проверяет JWT токен.

- Если токен истек, сервер проверяет refresh_token и выдает новый JWT.

5) *CatsImages:* Проверяет наличие фото по imageId в таблице images

6) *CatsImages:* Удаляет файл из MinIO и запись из базы данных PostgreSQL.

7) *CatsImages:* Возвращает подтверждение удаления.

*4. Пример запроса:*

- *Метод:* DELETE

- *URL:* https://cats-images.ru/images/{imageId}

- *query-параметры:* нет

- *Headers:* 

- Authorization: Bearer {token}

*4.2. Тело запроса:* отсутствует

*5. Пример ответа:*

- *HTTP-200:* Фото успешно удалено.

*Тело ответа:*
[source,json]
----
{
  "imageId": "12"
  "message": "Image successfully deleted"
}
----

- *HTTP-401:* Невалидный или просроченный токен.
*Тело ответа:*
[source,json]
----
{
  "error": "Unauthorized",
  "message": "Token is invalid or expired."
}
----

- *HTTP-404:* Фото не найдено.
*Тело ответа:*
[source,json]
----
{
  "error": "Image not found"
}
----


*Таблицы маппинга данных JSON и БД*

*6. Выходные параметры DELETE https://cats-images.ru/images/{imageId}*

|===
|*Название параметра на русском*|*Название параметра в JSON*|*Тип данных в JSON*|*Название параметра в БД*|*Тип данных в БД*|*Описание и алгоритм обработки данных*

|Идентификатор фото
|imageId
|string
|images.image_id
|UUID
|Уникальный идентификатор изображения, создается сервером и возвращается в ответе
|===

xref:../../index.adoc[Назад]